# templates/ -- Code Generation Templates

## Purpose

Contains template files used by `overstory init` and `overstory sling` to generate project-specific configuration and per-agent overlays. Templates use `{{VARIABLE}}` placeholder syntax for string substitution.

## Technology

- Markdown templates (`.md.tmpl`) with `{{PLACEHOLDER}}` syntax
- JSON template (`.json.tmpl`) for Claude Code hooks configuration
- Rendered by `src/agents/overlay.ts` and `src/commands/init.ts`

## Contents

| File | Description |
|------|-------------|
| `CLAUDE.md.tmpl` | Orchestrator CLAUDE.md generated by `overstory init` -- quick reference for spawning agents |
| `overlay.md.tmpl` | Per-worker CLAUDE.md overlay generated by `overstory sling` -- agent assignment, file scope, communication |
| `hooks.json.tmpl` | Claude Code `settings.local.json` hooks deployed to agent worktrees -- event logging, mail injection, tool guards |

## Key Functions

Not applicable -- these are template files consumed by TypeScript modules.

## Data Types

### Template Variables

**CLAUDE.md.tmpl:**
- `{{PROJECT_NAME}}` -- Project name from config
- `{{CANONICAL_BRANCH}}` -- Target merge branch (e.g., `main`)
- `{{AGENT_DEFINITIONS}}` -- Rendered capability list from manifest

**overlay.md.tmpl:**
- `{{AGENT_NAME}}`, `{{BEAD_ID}}`, `{{SPEC_PATH}}`, `{{BRANCH_NAME}}`
- `{{WORKTREE_PATH}}`, `{{PARENT_AGENT}}`, `{{DEPTH}}`
- `{{FILE_SCOPE}}`, `{{MULCH_DOMAINS}}`, `{{MULCH_EXPERTISE}}`
- `{{CAN_SPAWN}}`, `{{QUALITY_GATES}}`, `{{CONSTRAINTS}}`
- `{{BASE_DEFINITION}}`, `{{SPEC_INSTRUCTION}}`, `{{SKIP_SCOUT}}`

**hooks.json.tmpl:**
- `{{AGENT_NAME}}` -- Agent name for hook commands

## Logging

Not applicable.

## CRUD Entry Points

- **Create:** Add a new `.tmpl` file and update the consuming TypeScript module
- **Read:** `Bun.file(templatePath).text()` in `overlay.ts` and `init.ts`
- **Update:** Edit the template file; changes apply to all future generations
- **Delete:** Remove the template and update references in source code

## Style Guide

- Templates use `{{DOUBLE_BRACE}}` placeholder syntax
- JSON templates use tab indentation matching Biome config
- Markdown templates follow the agent definition section structure
- All hooks include `ENV_GUARD` prefix: `[ -z "$OVERSTORY_AGENT_NAME" ] && exit 0;`

```json
{
	"hooks": {
		"SessionStart": [
			{
				"matcher": "",
				"hooks": [
					{
						"type": "command",
						"command": "[ -z \"$OVERSTORY_AGENT_NAME\" ] && exit 0; overstory prime --agent {{AGENT_NAME}}"
					}
				]
			}
		]
	}
}
```
